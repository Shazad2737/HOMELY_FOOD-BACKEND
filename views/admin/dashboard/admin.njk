{% extends "../layouts/master.njk" %}

{% block container %}
	<!--begin::Main-->
	<div class="app-main flex-column flex-row-fluid" id="kt_app_main">
		<!--begin::Content wrapper-->
		<div class="d-flex flex-column flex-column-fluid">
			<!--begin::Toolbar-->
			<div id="kt_app_toolbar" class="app-toolbar pt-2 pt-lg-10">
				<!--begin::Toolbar container-->
				<div id="kt_app_toolbar_container" class="app-container container-fluid d-flex align-items-stretch">
					<!--begin::Toolbar wrapper-->
					<div class="app-toolbar-wrapper d-flex flex-stack flex-wrap gap-4 w-100">
						<!--begin::Page title-->
						<div class="page-title d-flex flex-column justify-content-center gap-1 me-3">
							<!--begin::Title-->
							<h1 class="page-heading d-flex flex-column justify-content-center text-gray-900 fw-bold fs-3 m-0">Dashboard</h1>
							<!--end::Title-->
							<!--begin::Breadcrumb-->
							<ul class="breadcrumb breadcrumb-separatorless fw-semibold fs-7 my-0">
								<!--begin::Item-->
								<li class="breadcrumb-item text-muted">
									<a href="/admin/dashboard" class="text-muted text-hover-primary">Home</a>
								</li>
								<!--end::Item-->
								<!--begin::Item-->
								<li class="breadcrumb-item">
									<span class="bullet bg-gray-500 w-5px h-2px"></span>
								</li>
								<!--end::Item-->
								<!--begin::Item-->
								<li class="breadcrumb-item text-muted">Dashboard</li>
								<!--end::Item-->
							</ul>
							<!--end::Breadcrumb-->
						</div>
						<!--end::Page title-->

						<!--begin::Total Units-->
						<div class="total-units d-flex align-items-center">
							<div class="nkl-card nkl-shadow-md p-4 rounded nkl-bg-primary nkl-text-white d-flex flex-column align-items-end">
								<span class="fs-7 fw-semibold">Total Customers</span>
								<h3 class="fw-bold mb-0" id="totalUnitsValue">{{ stats.totalCustomers }}</h3>
							</div>
						</div>
						<!--end::Total Units-->
					</div>
					<!--end::Toolbar wrapper-->
				</div>
				<!--end::Toolbar container-->
			</div>
			<!--end::Toolbar-->

			<!--begin::Content-->
			<div id="kt_app_content" class="app-content flex-column-fluid">
				<div id="kt_app_content_container" class="app-container container-fluid">

					<!--begin::Statistics Cards-->
					<div class="row g-5 g-xl-8 mb-5 mb-xl-8">
						<!--begin::Col-->
						<div class="col-xl-4 col-lg-6">
							<div class="card card-flush h-xl-100">
								<div class="card-body d-flex flex-column justify-content-between pb-5 px-6">
									<div class="d-flex align-items-center mb-3">
										<span class="svg-icon svg-icon-primary svg-icon-3x me-3">
											<i class="fas fa-users fs-2x text-primary"></i>
										</span>
										<div class="flex-grow-1">
											<span class="text-gray-500 fw-semibold d-block fs-7">Active Subscriptions</span>
											<span class="text-gray-800 fw-bold d-block fs-2x" id="activeSubscriptions">{{ stats.activeSubscriptions }}</span>
										</div>
									</div>
									<div class="d-flex align-items-center">
										<span class="badge badge-light-success fs-7">Active</span>
									</div>
								</div>
							</div>
						</div>
						<!--end::Col-->

						<!--begin::Col-->
						<div class="col-xl-4 col-lg-6">
							<div class="card card-flush h-xl-100">
								<div class="card-body d-flex flex-column justify-content-between pb-5 px-6">
									<div class="d-flex align-items-center mb-3">
										<span class="svg-icon svg-icon-success svg-icon-3x me-3">
											<i class="fas fa-shopping-cart fs-2x text-success"></i>
										</span>
										<div class="flex-grow-1">
											<span class="text-gray-500 fw-semibold d-block fs-7">Today's Orders</span>
											<span class="text-gray-800 fw-bold d-block fs-2x" id="todayOrders">{{ stats.todayOrders }}</span>
										</div>
									</div>
									<div class="d-flex align-items-center">
										<span class="text-muted fs-8">Total: {{ stats.totalOrders }}</span>
									</div>
								</div>
							</div>
						</div>
						<!--end::Col-->

						<!--begin::Col-->
						<div class="col-xl-4 col-lg-6">
							<div class="card card-flush h-xl-100">
								<div class="card-body d-flex flex-column justify-content-between pb-5 px-6">
									<div class="d-flex align-items-center mb-3">
										<span class="svg-icon svg-icon-warning svg-icon-3x me-3">
											<i class="fas fa-utensils fs-2x text-warning"></i>
										</span>
										<div class="flex-grow-1">
											<span class="text-gray-500 fw-semibold d-block fs-7">Food Items</span>
											<span class="text-gray-800 fw-bold d-block fs-2x">{{ stats.activeFoodItems }}</span>
										</div>
									</div>
									<div class="d-flex align-items-center">
										<span class="text-muted fs-8">Total: {{ stats.totalFoodItems }}</span>
									</div>
								</div>
							</div>
						</div>
						<!--end::Col-->
					</div>
					<!--end::Statistics Cards-->

					<!--begin::Customer Stats & Recent Orders Row-->
					<div class="row g-5 g-xl-8 mt-5 align-items-stretch">
						<!--begin::Customer Stats-->
						<div class="col-xl-6 col-lg-12">
							<div class="card card-flush h-100">
								<div class="card-header pt-5">
									<h3 class="card-title align-items-start flex-column">
										<span class="card-label fw-bold text-gray-800">Customer Statistics</span>
										<span class="text-gray-500 mt-1 fw-semibold fs-7">Current Status</span>
									</h3>
								</div>
								<div class="card-body pt-6">
									<div class="d-flex align-items-center mb-7">
										<div class="symbol symbol-50px me-5">
											<span class="symbol-label bg-light-success">
												<i class="fas fa-user-check fs-2x text-success"></i>
											</span>
										</div>
										<div class="flex-grow-1">
											<a href="#" class="text-gray-800 text-hover-primary fs-5 fw-bold">Active Customers</a>
											<span class="text-gray-500 fw-semibold d-block fs-6">With Active Subscriptions</span>
										</div>
										<span class="badge badge-light-success fs-7 fw-bold">{{ stats.activeCustomers }}</span>
									</div>

									<div class="d-flex align-items-center mb-7">
										<div class="symbol symbol-50px me-5">
											<span class="symbol-label bg-light-warning">
												<i class="fas fa-user-clock fs-2x text-warning"></i>
											</span>
										</div>
										<div class="flex-grow-1">
											<a href="#" class="text-gray-800 text-hover-primary fs-5 fw-bold">Pending Verification</a>
											<span class="text-gray-500 fw-semibold d-block fs-6">Awaiting OTP</span>
										</div>
										<span class="badge badge-light-warning fs-7 fw-bold">{{ stats.pendingVerification }}</span>
									</div>

									<div class="d-flex align-items-center">
										<div class="symbol symbol-50px me-5">
											<span class="symbol-label bg-light-danger">
												<i class="fas fa-user-times fs-2x text-danger"></i>
											</span>
										</div>
										<div class="flex-grow-1">
											<a href="#" class="text-gray-800 text-hover-primary fs-5 fw-bold">Inactive Customers</a>
											<span class="text-gray-500 fw-semibold d-block fs-6">No Active Subscriptions</span>
										</div>
										<span class="badge badge-light-danger fs-7 fw-bold">{{ stats.inactiveCustomers }}</span>
									</div>
								</div>
							</div>
						</div>
						<!--end::Customer Stats-->

						<!--begin::Recent Orders-->
						<div class="col-xl-6 col-lg-12">
							<div class="card card-flush h-100 d-flex flex-column">
								<div class="card-header align-items-center py-5 gap-2 gap-md-5">
									<div class="card-title">
										<h3 class="fw-bold m-0">Recent Orders</h3>
									</div>
								</div>
								<div class="card-body pt-0 flex-grow-1 overflow-auto" style="max-height: 450px;">
									<div class="table-responsive">
										<table class="table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4">
											<thead>
												<tr class="fw-bold text-muted">
													<th class="min-w-150px">Order Number</th>
													<th class="min-w-150px">Customer</th>
													<th class="min-w-100px">Order Date</th>
													<th class="min-w-100px">Status</th>
												</tr>
											</thead>
											<tbody>
												{% for order in recentOrders %}
													<tr>
														<td>
															<a href="/admin/orders/{{ order.id }}" class="text-gray-800 text-hover-primary fw-bold">
																{{ order.orderNumber }}
															</a>
														</td>
														<td>
															<div class="d-flex flex-column">
																<span class="text-gray-800 fw-bold">{{ order.customer.name }}</span>
																{# <span class="text-muted fs-7">{{ order.customer.mobile }}</span> #}
															</div>
														</td>
														<td>
															<span class="text-gray-800">{{ formatDateInTimezone(order.orderDate) }}</span>
														</td>
														<td>
															{% if order.status === 'CONFIRMED' %}
																<span class="badge badge-light-info">Confirmed</span>
															{% elif order.status === 'DELIVERED' %}
																<span class="badge badge-light-success">Delivered</span>
															{% elif order.status === 'CANCELLED' %}
																<span class="badge badge-light-danger">Cancelled</span>
															{% endif %}
														</td>
													</tr>
												{% else %}
													<tr>
														<td colspan="7" class="text-center text-muted py-5">No orders found</td>
													</tr>
												{% endfor %}
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
						<!--end::Recent Orders-->
					</div>
					<!--end::Customer Stats & Recent Orders Row-->

				</div>
			</div>
			<!--end::Content-->
		</div>
		<!--end::Content wrapper-->

		<!--begin::Footer-->
		{% include '../partials/_footer-panel.njk' %}
		<!--end::Footer-->
	</div>
	<!--end:::Main-->
{% endblock %}

{% block scripts %}{% endblock %}